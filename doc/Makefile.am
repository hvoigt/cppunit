man3dir = $(mandir)/man3
# FIXME: should be in ${datadir} (i.e. ${prefix}/share) ?
docdir  = $(prefix)/doc/@PACKAGE@-@VERSION@
htmldir = $(docdir)/html

EXTRA_DIST = cookbook.html header.html footer.html other_documentation.dox


if DOC
html_DATA = html/*

all-local: dox #pdf
endif

man_extension_dir = man/man3/extensions

dox: html/index.html
html/* html/index.html: Doxyfile other_documentation.dox $(man_extension_dir)
	@DOXYGEN@

# Workaround for broken Doxygen.  Version 1.2.9.1 doesn't create
# this directory, though it does create man/man3.
$(man_extension_dir):
	mkdir -p $@

pdf: @PACKAGE@.pdf
@PACKAGE@.pdf:
	$(MAKE) -C ./latex pdf
	ln -s ./latex/refman.ps	 @PACKAGE@.ps
	ln -s ./latex/refman.pdf @PACKAGE@.pdf


#install-data-local:

# This is failing because doxygen generates manpage filenames with
# spaces in them.  Removed until fixed -smr.
# 
#	$(mkinstalldirs) $(DESTDIR)$(man3dir)
#	@for i in ./man/man3/*.3; do \
#		inst=`basename $$i | sed 's/_/:/g'`; \
#		echo "$(INSTALL_DATA) $$i $(DESTDIR)$(man3dir)/$$inst"; \
#		$(INSTALL_DATA) $$i $(DESTDIR)$(man3dir)/$$inst; \
#	done

# This is replaced by html_DATA.
#	$(mkinstalldirs) $(DESTDIR)$(docdir)
#	cp -r html $(DESTDIR)$(docdir)

# This was commented out long ago.
#	@for i in ../README ../ChangeLog @PACKAGE@.ps @PACKAGE@.pdf; do \
#		echo "$(INSTALL_DATA) $$i $(DESTDIR)$(docdir)"; \
#		$(INSTALL_DATA) $$i $(DESTDIR)$(docdir); \
#	done

clean-local:
	$(RM) -r latex
	$(RM) -r html man @PACKAGE@.ps @PACKAGE@.pdf
